<!DOCTYPE html>
<html lang="km">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vann Student Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --surface3: #1f2d44;
    --border: #243047;
    --accent: #3b82f6;
    --accent2: #6366f1;
    --accent3: #10b981;
    --accent4: #f59e0b;
    --danger: #ef4444;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --text3: #64748b;
    --glow: rgba(59,130,246,0.15);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Sora',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width:6px; }
  ::-webkit-scrollbar-track { background:var(--surface); }
  ::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

  /* LOGIN */
  #loginScreen {
    position:fixed; inset:0; z-index:9999;
    background:var(--bg);
    display:flex; align-items:center; justify-content:center;
    background-image: radial-gradient(ellipse at 20% 50%, rgba(59,130,246,0.08) 0%, transparent 60%),
                      radial-gradient(ellipse at 80% 20%, rgba(99,102,241,0.06) 0%, transparent 50%);
  }
  .login-box {
    width:420px; padding:48px 40px;
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:20px;
    box-shadow:0 0 60px rgba(59,130,246,0.1);
    animation: fadeUp 0.6s ease;
  }
  @keyframes fadeUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:none} }
  .login-logo { text-align:center; margin-bottom:32px; }
  .login-logo .logo-icon {
    width:64px; height:64px; margin:0 auto 12px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    border-radius:16px; display:flex; align-items:center; justify-content:center;
    font-size:28px;
  }
  .login-logo h1 { font-size:22px; font-weight:700; }
  .login-logo p { color:var(--text2); font-size:13px; margin-top:4px; }
  .role-tabs { display:flex; gap:8px; margin-bottom:24px; }
  .role-tab {
    flex:1; padding:10px; border:1px solid var(--border); border-radius:10px;
    background:transparent; color:var(--text2); cursor:pointer; font-family:inherit;
    font-size:13px; transition:all 0.2s; text-align:center;
  }
  .role-tab.active { background:var(--accent); color:#fff; border-color:var(--accent); }
  .form-group { margin-bottom:16px; }
  .form-group label { display:block; font-size:12px; color:var(--text2); margin-bottom:6px; font-weight:500; letter-spacing:0.05em; text-transform:uppercase; }
  .form-group input, .form-group select {
    width:100%; padding:12px 14px; background:var(--surface2);
    border:1px solid var(--border); border-radius:10px; color:var(--text);
    font-family:inherit; font-size:14px; transition:border 0.2s; outline:none;
  }
  .form-group input:focus, .form-group select:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--glow); }
  .btn-primary {
    width:100%; padding:14px; background:linear-gradient(135deg,var(--accent),var(--accent2));
    border:none; border-radius:10px; color:#fff; font-family:inherit;
    font-size:15px; font-weight:600; cursor:pointer; transition:opacity 0.2s;
  }
  .btn-primary:hover { opacity:0.9; }
  .login-hint { margin-top:16px; text-align:center; font-size:12px; color:var(--text3); }

  /* MAIN LAYOUT */
  #app { display:flex; min-height:100vh; }
  #sidebar {
    width:260px; background:var(--surface); border-right:1px solid var(--border);
    display:flex; flex-direction:column; position:fixed; top:0; left:0; bottom:0; z-index:100;
    transition:transform 0.3s;
  }
  .sidebar-header {
    padding:24px 20px; border-bottom:1px solid var(--border);
    display:flex; align-items:center; gap:12px;
  }
  .sidebar-logo {
    width:40px; height:40px; border-radius:12px; flex-shrink:0;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    display:flex; align-items:center; justify-content:center; font-size:20px;
  }
  .sidebar-title { font-size:14px; font-weight:700; line-height:1.3; }
  .sidebar-subtitle { font-size:11px; color:var(--text3); }
  .sidebar-user {
    padding:16px 20px; border-bottom:1px solid var(--border);
    display:flex; align-items:center; gap:10px;
  }
  .user-avatar {
    width:36px; height:36px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    font-size:15px; font-weight:600; flex-shrink:0;
  }
  .user-info .user-name { font-size:13px; font-weight:600; }
  .user-info .user-role {
    font-size:11px; padding:2px 8px; border-radius:20px;
    display:inline-block; margin-top:2px; font-weight:500;
  }
  .role-admin { background:rgba(239,68,68,0.15); color:#f87171; }
  .role-teacher { background:rgba(59,130,246,0.15); color:#60a5fa; }
  .role-student { background:rgba(16,185,129,0.15); color:#34d399; }
  nav { padding:12px 12px; flex:1; overflow-y:auto; }
  .nav-section { margin-bottom:20px; }
  .nav-label { font-size:10px; font-weight:600; color:var(--text3); text-transform:uppercase; letter-spacing:0.1em; padding:0 8px; margin-bottom:6px; }
  .nav-item {
    display:flex; align-items:center; gap:10px; padding:10px 12px;
    border-radius:10px; cursor:pointer; font-size:13px; font-weight:500;
    color:var(--text2); transition:all 0.2s; margin-bottom:2px;
    position:relative; border:none; background:none; width:100%; text-align:left;
  }
  .nav-item:hover { background:var(--surface2); color:var(--text); }
  .nav-item.active { background:rgba(59,130,246,0.15); color:var(--accent); }
  .nav-item .nav-icon { font-size:16px; width:20px; text-align:center; }
  .nav-badge {
    margin-left:auto; font-size:10px; font-weight:600; padding:2px 7px;
    border-radius:20px; background:var(--accent); color:#fff;
  }
  .sidebar-footer { padding:12px 20px; border-top:1px solid var(--border); }
  .btn-logout {
    width:100%; padding:10px; border:1px solid var(--border); border-radius:10px;
    background:none; color:var(--text2); font-family:inherit; font-size:13px;
    cursor:pointer; transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:8px;
  }
  .btn-logout:hover { background:rgba(239,68,68,0.1); color:var(--danger); border-color:var(--danger); }

  /* MAIN */
  #main { margin-left:260px; flex:1; display:flex; flex-direction:column; min-height:100vh; }
  .topbar {
    padding:16px 32px; border-bottom:1px solid var(--border);
    display:flex; align-items:center; justify-content:space-between;
    background:var(--surface); position:sticky; top:0; z-index:50;
  }
  .topbar-left h2 { font-size:18px; font-weight:700; }
  .topbar-left p { font-size:12px; color:var(--text3); margin-top:2px; }
  .topbar-actions { display:flex; align-items:center; gap:12px; }
  .btn { padding:9px 18px; border-radius:9px; font-family:inherit; font-size:13px; font-weight:600; cursor:pointer; border:none; transition:all 0.2s; display:inline-flex; align-items:center; gap:8px; }
  .btn-sm { padding:7px 14px; font-size:12px; }
  .btn-blue { background:var(--accent); color:#fff; }
  .btn-blue:hover { opacity:0.85; }
  .btn-green { background:var(--accent3); color:#fff; }
  .btn-green:hover { opacity:0.85; }
  .btn-red { background:var(--danger); color:#fff; }
  .btn-red:hover { opacity:0.85; }
  .btn-ghost { background:var(--surface2); color:var(--text); border:1px solid var(--border); }
  .btn-ghost:hover { background:var(--surface3); }
  .content { padding:28px 32px; flex:1; }

  /* PAGES */
  .page { display:none; }
  .page.active { display:block; animation:fadeIn 0.3s ease; }
  @keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }

  /* STATS GRID */
  .stats-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:24px; }
  .stat-card {
    padding:20px; border-radius:14px; border:1px solid var(--border);
    background:var(--surface); position:relative; overflow:hidden;
  }
  .stat-card::before {
    content:''; position:absolute; top:-30px; right:-30px;
    width:80px; height:80px; border-radius:50%; opacity:0.15;
  }
  .stat-card.blue::before { background:var(--accent); }
  .stat-card.purple::before { background:var(--accent2); }
  .stat-card.green::before { background:var(--accent3); }
  .stat-card.amber::before { background:var(--accent4); }
  .stat-icon { font-size:22px; margin-bottom:12px; }
  .stat-value { font-size:28px; font-weight:800; font-family:'JetBrains Mono',monospace; }
  .stat-label { font-size:12px; color:var(--text2); margin-top:4px; font-weight:500; }
  .stat-change { font-size:11px; margin-top:6px; }
  .stat-change.up { color:var(--accent3); }
  .stat-change.down { color:var(--danger); }

  /* CARDS */
  .card { background:var(--surface); border:1px solid var(--border); border-radius:14px; }
  .card-header { padding:18px 20px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
  .card-title { font-size:14px; font-weight:700; }
  .card-body { padding:20px; }

  /* TABLE */
  .table-wrap { overflow-x:auto; }
  table { width:100%; border-collapse:collapse; }
  th { padding:10px 14px; font-size:11px; font-weight:600; color:var(--text3); text-transform:uppercase; letter-spacing:0.06em; text-align:left; border-bottom:1px solid var(--border); }
  td { padding:12px 14px; font-size:13px; border-bottom:1px solid var(--border); color:var(--text2); }
  tr:last-child td { border-bottom:none; }
  tr:hover td { background:var(--surface2); }
  .badge { display:inline-flex; align-items:center; padding:3px 10px; border-radius:20px; font-size:11px; font-weight:600; }
  .badge-blue { background:rgba(59,130,246,0.15); color:#60a5fa; }
  .badge-green { background:rgba(16,185,129,0.15); color:#34d399; }
  .badge-red { background:rgba(239,68,68,0.15); color:#f87171; }
  .badge-amber { background:rgba(245,158,11,0.15); color:#fbbf24; }
  .badge-purple { background:rgba(99,102,241,0.15); color:#a5b4fc; }

  /* SEARCH / FILTER BAR */
  .search-bar {
    display:flex; align-items:center; gap:12px; margin-bottom:20px;
  }
  .search-wrap { position:relative; flex:1; }
  .search-wrap input {
    width:100%; padding:10px 14px 10px 38px;
    background:var(--surface); border:1px solid var(--border);
    border-radius:10px; color:var(--text); font-family:inherit; font-size:13px; outline:none;
    transition:border 0.2s;
  }
  .search-wrap input:focus { border-color:var(--accent); }
  .search-wrap .search-icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--text3); font-size:15px; }
  .filter-select {
    padding:10px 14px; background:var(--surface); border:1px solid var(--border);
    border-radius:10px; color:var(--text); font-family:inherit; font-size:13px; outline:none; cursor:pointer;
  }

  /* MODAL */
  .modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:200;
    display:none; align-items:center; justify-content:center; backdrop-filter:blur(4px);
  }
  .modal-overlay.open { display:flex; }
  .modal {
    background:var(--surface); border:1px solid var(--border); border-radius:20px;
    width:520px; max-width:95vw; max-height:90vh; overflow:hidden;
    display:flex; flex-direction:column;
    animation:modalIn 0.3s ease;
  }
  @keyframes modalIn { from{opacity:0;transform:scale(0.9)} to{opacity:1;transform:none} }
  .modal-header { padding:20px 24px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; }
  .modal-header h3 { font-size:16px; font-weight:700; }
  .modal-close { background:none; border:none; color:var(--text3); cursor:pointer; font-size:20px; padding:4px 8px; border-radius:6px; }
  .modal-close:hover { background:var(--surface2); color:var(--text); }
  .modal-body { padding:24px; overflow-y:auto; }
  .modal-footer { padding:16px 24px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px; }
  .form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .form-group { margin-bottom:16px; }
  .form-group:last-child { margin-bottom:0; }
  .form-group label { display:block; font-size:12px; color:var(--text2); margin-bottom:6px; font-weight:500; }
  .form-group input, .form-group select, .form-group textarea {
    width:100%; padding:10px 12px; background:var(--surface2);
    border:1px solid var(--border); border-radius:9px; color:var(--text);
    font-family:inherit; font-size:13px; outline:none; transition:border 0.2s;
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color:var(--accent); }
  .form-group textarea { resize:vertical; min-height:80px; }

  /* DASHBOARD CHARTS */
  .charts-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:24px; }
  .chart-bar-wrap { height:140px; display:flex; align-items:flex-end; gap:10px; padding:0 4px; }
  .chart-bar-group { flex:1; display:flex; flex-direction:column; align-items:center; gap:6px; }
  .chart-bar { width:100%; border-radius:6px 6px 0 0; position:relative; cursor:pointer; transition:opacity 0.2s; min-height:4px; }
  .chart-bar:hover { opacity:0.8; }
  .chart-bar-label { font-size:10px; color:var(--text3); }
  .chart-bar-val { font-size:10px; color:var(--text2); font-family:'JetBrains Mono',monospace; }
  .donut-wrap { display:flex; align-items:center; justify-content:center; gap:24px; }
  .donut-svg { transform:rotate(-90deg); }
  .donut-legend { display:flex; flex-direction:column; gap:8px; }
  .donut-item { display:flex; align-items:center; gap:8px; font-size:12px; }
  .donut-dot { width:10px; height:10px; border-radius:50%; }

  /* ATTENDANCE */
  .attendance-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:8px; }
  .att-day { display:flex; flex-direction:column; align-items:center; gap:4px; }
  .att-day-name { font-size:10px; color:var(--text3); font-weight:600; }
  .att-cell {
    width:36px; height:36px; border-radius:8px; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    font-size:11px; font-weight:600; border:1px solid var(--border);
    background:var(--surface2); color:var(--text3); transition:all 0.2s;
  }
  .att-cell.present { background:rgba(16,185,129,0.2); border-color:var(--accent3); color:var(--accent3); }
  .att-cell.absent { background:rgba(239,68,68,0.15); border-color:var(--danger); color:var(--danger); }
  .att-cell.late { background:rgba(245,158,11,0.15); border-color:var(--accent4); color:var(--accent4); }
  .att-cell:hover { transform:scale(1.1); }

  /* GRADE SLIDER */
  .grade-display {
    display:flex; align-items:center; gap:12px; padding:14px;
    background:var(--surface2); border-radius:10px; margin-bottom:8px;
  }
  .grade-subject { flex:1; font-size:13px; font-weight:500; }
  .grade-score { font-family:'JetBrains Mono',monospace; font-size:18px; font-weight:700; }
  .grade-letter { font-size:13px; font-weight:600; padding:3px 10px; border-radius:6px; }
  .grade-bar-bg { flex:2; height:8px; background:var(--surface3); border-radius:4px; overflow:hidden; }
  .grade-bar-fill { height:100%; border-radius:4px; transition:width 0.5s ease; }

  /* PAYMENT */
  .payment-status { display:flex; align-items:center; justify-content:space-between; padding:14px; background:var(--surface2); border-radius:10px; margin-bottom:8px; }
  .payment-month { font-size:13px; font-weight:600; }
  .payment-amount { font-family:'JetBrains Mono',monospace; font-size:14px; color:var(--accent4); }

  /* SCHEDULE */
  .schedule-grid { display:grid; grid-template-columns:auto repeat(5,1fr); gap:4px; }
  .sch-header { padding:8px; font-size:11px; font-weight:600; color:var(--text3); text-align:center; }
  .sch-time { padding:8px 10px; font-size:11px; color:var(--text3); font-family:'JetBrains Mono',monospace; white-space:nowrap; }
  .sch-cell { padding:8px 6px; border-radius:8px; min-height:52px; display:flex; flex-direction:column; justify-content:center; }
  .sch-cell.has-class { padding:8px; }
  .sch-class-name { font-size:11px; font-weight:600; }
  .sch-class-room { font-size:10px; color:var(--text3); margin-top:2px; }
  .sch-cell.blue { background:rgba(59,130,246,0.12); border-left:2px solid var(--accent); }
  .sch-cell.green { background:rgba(16,185,129,0.1); border-left:2px solid var(--accent3); }
  .sch-cell.purple { background:rgba(99,102,241,0.1); border-left:2px solid var(--accent2); }
  .sch-cell.amber { background:rgba(245,158,11,0.1); border-left:2px solid var(--accent4); }

  /* NOTIFICATION */
  .notif-item { padding:14px; border-bottom:1px solid var(--border); display:flex; gap:12px; }
  .notif-item:last-child { border-bottom:none; }
  .notif-icon { width:36px; height:36px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; }
  .notif-content .notif-title { font-size:13px; font-weight:600; }
  .notif-content .notif-text { font-size:12px; color:var(--text2); margin-top:2px; }
  .notif-content .notif-time { font-size:11px; color:var(--text3); margin-top:4px; }
  .notif-dot { width:8px; height:8px; background:var(--accent); border-radius:50%; flex-shrink:0; margin-top:5px; }

  /* REPORT CARD */
  .report-card {
    background:var(--surface); border:1px solid var(--border); border-radius:16px;
    padding:32px; max-width:680px; margin:0 auto;
  }
  .report-header { display:flex; align-items:center; gap:20px; margin-bottom:24px; padding-bottom:20px; border-bottom:2px solid var(--border); }
  .report-logo { width:60px; height:60px; border-radius:14px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; font-size:28px; }
  .report-school h2 { font-size:18px; font-weight:800; }
  .report-school p { color:var(--text2); font-size:13px; }
  .report-student-info { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:20px; }
  .report-info-item label { font-size:11px; color:var(--text3); display:block; margin-bottom:4px; font-weight:500; text-transform:uppercase; }
  .report-info-item span { font-size:14px; font-weight:600; }
  .report-table table { width:100%; }
  .report-table th { background:var(--surface2); }
  .report-summary { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:20px; }
  .report-summary-item { text-align:center; padding:14px; background:var(--surface2); border-radius:10px; }
  .report-summary-item .val { font-size:22px; font-weight:800; font-family:'JetBrains Mono',monospace; }
  .report-summary-item .lbl { font-size:11px; color:var(--text3); margin-top:4px; }

  /* PROFILE */
  .profile-header { display:flex; align-items:center; gap:24px; margin-bottom:28px; padding:24px; background:var(--surface); border-radius:16px; border:1px solid var(--border); }
  .profile-avatar { width:80px; height:80px; border-radius:20px; display:flex; align-items:center; justify-content:center; font-size:36px; font-weight:700; flex-shrink:0; }
  .profile-info h3 { font-size:20px; font-weight:700; }
  .profile-info p { color:var(--text2); font-size:14px; margin-top:4px; }
  .profile-tags { display:flex; gap:8px; margin-top:8px; }
  .profile-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }

  /* QR CODE SIMULATION */
  .qr-box {
    width:180px; height:180px; margin:0 auto 16px;
    background:white; border-radius:12px; padding:12px;
    display:grid; grid-template-columns:repeat(9,1fr); grid-template-rows:repeat(9,1fr); gap:2px;
  }
  .qr-cell { border-radius:1px; }

  /* RESPONSIVE TOPBAR TOGGLE */
  .menu-toggle { display:none; background:none; border:none; color:var(--text); font-size:22px; cursor:pointer; }
  @media(max-width:900px) {
    #sidebar { transform:translateX(-100%); }
    #sidebar.open { transform:none; }
    #main { margin-left:0; }
    .menu-toggle { display:block; }
    .stats-grid { grid-template-columns:1fr 1fr; }
    .charts-grid { grid-template-columns:1fr; }
    .form-row { grid-template-columns:1fr; }
  }

  /* TOAST */
  #toast {
    position:fixed; bottom:24px; right:24px; z-index:9000;
    background:var(--surface); border:1px solid var(--border); border-radius:12px;
    padding:14px 20px; font-size:13px; font-weight:500;
    box-shadow:0 8px 32px rgba(0,0,0,0.4); display:none; align-items:center; gap:10px;
    animation:slideUp 0.3s ease;
  }
  @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:none;opacity:1} }
  #toast.show { display:flex; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">
      <div class="logo-icon">üéì</div>
      <h1>VANN System</h1>
      <p>Student Management Platform</p>
    </div>
    <div class="role-tabs">
      <button class="role-tab active" onclick="selectRole('Admin')">üëë Admin</button>
      <button class="role-tab" onclick="selectRole('Teacher')">üë®‚Äçüè´ Teacher</button>
      <button class="role-tab" onclick="selectRole('Student')">üéí Student</button>
    </div>
    <div class="form-group">
      <label>Username</label>
      <input id="loginUser" type="text" placeholder="Enter username..." value="admin">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input id="loginPass" type="password" placeholder="Enter password..." value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <button class="btn-primary" onclick="doLogin()">üîê Sign In</button>
    <p class="login-hint">Demo: Any credentials work for all roles</p>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none">

  <!-- SIDEBAR -->
  <aside id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">üéì</div>
      <div>
        <div class="sidebar-title">VANNEdu</div>
        <div class="sidebar-subtitle">Management System</div>
      </div>
    </div>
    <div class="sidebar-user">
      <div class="user-avatar" id="sidebarAvatar" style="background:linear-gradient(135deg,#3b82f6,#6366f1)">A</div>
      <div class="user-info">
        <div class="user-name" id="sidebarName">Administrator</div>
        <span class="user-role role-admin" id="sidebarRole">Admin</span>
      </div>
    </div>
    <nav id="navMenu">
      <!-- Built dynamically -->
    </nav>
    <div class="sidebar-footer">
      <button class="btn-logout" onclick="doLogout()">üö™ Sign Out</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main id="main">
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px">
        <button class="menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>
        <div class="topbar-left">
          <h2 id="pageTitle">Dashboard</h2>
          <p id="pageSubtitle">Welcome back! Here's what's happening.</p>
        </div>
      </div>
      <div class="topbar-actions" id="topbarActions"></div>
    </div>
    <div class="content" id="pageContent">
      <!-- Pages rendered here -->
    </div>
  </main>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this)closeModal()">
  <div class="modal" id="modal">
    <div class="modal-header">
      <h3 id="modalTitle">Modal</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer" id="modalFooter"></div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"><span id="toastIcon">‚úÖ</span><span id="toastMsg">Done!</span></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA STORE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentRole = 'Admin';
let currentUser = { name:'Administrator', avatar:'A', color:'linear-gradient(135deg,#3b82f6,#6366f1)' };
let currentPage = 'dashboard';

const db = {
  students: [
    {id:'S001', name:'Sokha Chea', gender:'Male', dob:'2008-03-12', class:'Grade 10A', phone:'012-345-678', email:'sokha@edu.kh', gpa:3.8, status:'Active', address:'Phnom Penh'},
    {id:'S002', name:'Bopha Lim', gender:'Female', dob:'2008-07-22', class:'Grade 10A', phone:'011-223-334', email:'bopha@edu.kh', gpa:3.5, status:'Active', address:'Siem Reap'},
    {id:'S003', name:'Dara Kong', gender:'Male', dob:'2007-11-05', class:'Grade 11B', phone:'016-444-555', email:'dara@edu.kh', gpa:2.9, status:'Active', address:'Battambang'},
    {id:'S004', name:'Sreymom Yun', gender:'Female', dob:'2007-04-18', class:'Grade 11B', phone:'015-666-777', email:'sreymom@edu.kh', gpa:3.2, status:'Active', address:'Kampot'},
    {id:'S005', name:'Visal Chan', gender:'Male', dob:'2009-01-30', class:'Grade 9C', phone:'017-888-999', email:'visal@edu.kh', gpa:3.6, status:'Inactive', address:'Kandal'},
    {id:'S006', name:'Pich Sok', gender:'Female', dob:'2009-06-14', class:'Grade 9C', phone:'010-111-222', email:'pich@edu.kh', gpa:4.0, status:'Active', address:'Phnom Penh'},
    {id:'S007', name:'Ratha Pen', gender:'Male', dob:'2008-09-25', class:'Grade 10B', phone:'012-333-444', email:'ratha@edu.kh', gpa:3.1, status:'Active', address:'Prey Veng'},
    {id:'S008', name:'Channary Keo', gender:'Female', dob:'2008-12-03', class:'Grade 10B', phone:'011-555-666', email:'channary@edu.kh', gpa:3.7, status:'Active', address:'Takeo'},
  ],
  teachers: [
    {id:'T001', name:'Sophea Rin', gender:'Female', subject:'Mathematics', phone:'012-100-200', email:'sophea@edu.kh', status:'Active', hire:'2018-08-01'},
    {id:'T002', name:'Phirum Vong', gender:'Male', subject:'Physics', phone:'011-300-400', email:'phirum@edu.kh', status:'Active', hire:'2019-01-15'},
    {id:'T003', name:'Narath Kim', gender:'Male', subject:'Khmer Literature', phone:'016-500-600', email:'narath@edu.kh', status:'Active', hire:'2017-03-20'},
    {id:'T004', name:'Sokunthea Heng', gender:'Female', subject:'English', phone:'015-700-800', email:'sokunthea@edu.kh', status:'Active', hire:'2020-09-01'},
    {id:'T005', name:'Bunthoeun Mao', gender:'Male', subject:'History', phone:'017-900-100', email:'bunthoeun@edu.kh', status:'Inactive', hire:'2016-06-10'},
  ],
  classes: [
    {id:'C001', name:'Grade 9C', teacher:'Narath Kim', students:32, room:'Room 101', year:'2025-2026'},
    {id:'C002', name:'Grade 10A', teacher:'Sophea Rin', students:35, room:'Room 201', year:'2025-2026'},
    {id:'C003', name:'Grade 10B', teacher:'Sokunthea Heng', students:33, room:'Room 202', year:'2025-2026'},
    {id:'C004', name:'Grade 11B', teacher:'Phirum Vong', students:29, room:'Room 301', year:'2025-2026'},
    {id:'C005', name:'Grade 12A', teacher:'Bunthoeun Mao', students:28, room:'Room 302', year:'2025-2026'},
  ],
  subjects: [
    {id:'SUB001', name:'Mathematics', code:'MATH', teacher:'Sophea Rin', credits:4, classes:'10A,10B,11B', type:'Core'},
    {id:'SUB002', name:'Physics', code:'PHY', teacher:'Phirum Vong', credits:3, classes:'10A,11B', type:'Core'},
    {id:'SUB003', name:'Khmer Literature', code:'KHM', teacher:'Narath Kim', credits:3, classes:'9C,10A,10B,11B', type:'Core'},
    {id:'SUB004', name:'English', code:'ENG', teacher:'Sokunthea Heng', credits:4, classes:'9C,10A,10B', type:'Core'},
    {id:'SUB005', name:'History', code:'HIS', teacher:'Bunthoeun Mao', credits:2, classes:'9C,11B', type:'Elective'},
    {id:'SUB006', name:'Chemistry', code:'CHEM', teacher:'Phirum Vong', credits:3, classes:'11B', type:'Core'},
  ],
  scores: [
    {id:'SC001', student:'Sokha Chea', class:'Grade 10A', subject:'Mathematics', midterm:78, final:85, assignments:90, total:84, grade:'B+'},
    {id:'SC002', student:'Sokha Chea', class:'Grade 10A', subject:'Physics', midterm:72, final:80, assignments:85, total:79, grade:'B'},
    {id:'SC003', student:'Sokha Chea', class:'Grade 10A', subject:'Khmer Literature', midterm:88, final:92, assignments:95, total:91, grade:'A'},
    {id:'SC004', student:'Bopha Lim', class:'Grade 10A', subject:'Mathematics', midterm:65, final:70, assignments:75, total:70, grade:'B-'},
    {id:'SC005', student:'Bopha Lim', class:'Grade 10A', subject:'English', midterm:88, final:90, assignments:92, total:90, grade:'A'},
    {id:'SC006', student:'Dara Kong', class:'Grade 11B', subject:'Mathematics', midterm:55, final:60, assignments:65, total:60, grade:'C'},
    {id:'SC007', student:'Pich Sok', class:'Grade 9C', subject:'Mathematics', midterm:96, final:98, assignments:100, total:98, grade:'A+'},
    {id:'SC008', student:'Pich Sok', class:'Grade 9C', subject:'English', midterm:92, final:95, assignments:97, total:95, grade:'A+'},
  ],
  attendance: {
    'S001': [1,1,1,0,1,1,1,1,2,1,1,1,1,1,0,1,1,1,1,1],
    'S002': [1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1],
    'S003': [1,0,1,1,2,1,1,0,1,1,1,1,2,1,1,1,0,1,1,1],
    'S004': [1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,1],
  },
  payments: [
    {id:'P001', student:'Sokha Chea', month:'January 2026', amount:45, paid:true, date:'2026-01-05'},
    {id:'P002', student:'Sokha Chea', month:'February 2026', amount:45, paid:true, date:'2026-02-03'},
    {id:'P003', student:'Sokha Chea', month:'March 2026', amount:45, paid:false, date:null},
    {id:'P004', student:'Bopha Lim', month:'January 2026', amount:45, paid:true, date:'2026-01-08'},
    {id:'P005', student:'Bopha Lim', month:'February 2026', amount:45, paid:false, date:null},
    {id:'P006', student:'Dara Kong', month:'January 2026', amount:45, paid:true, date:'2026-01-10'},
    {id:'P007', student:'Dara Kong', month:'February 2026', amount:45, paid:true, date:'2026-02-07'},
  ],
  notifications: [
    {id:1, type:'info', icon:'üìã', title:'New Enrollment', text:'3 new students registered for Grade 10A', time:'5 min ago', read:false},
    {id:2, type:'warning', icon:'‚ö†Ô∏è', title:'Payment Due', text:'15 students have unpaid fees for February', time:'2h ago', read:false},
    {id:3, type:'success', icon:'‚úÖ', title:'Exam Results', text:'Grade 11B semester results are ready', time:'5h ago', read:true},
    {id:4, type:'info', icon:'üìÖ', title:'Schedule Update', text:'Monday Physics class moved to Room 302', time:'1d ago', read:true},
    {id:5, type:'danger', icon:'üö®', title:'Absence Alert', text:'Dara Kong absent 3 days in a row', time:'2d ago', read:true},
  ]
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const roleConfigs = {
  Admin: {
    color:'linear-gradient(135deg,#ef4444,#f97316)', badgeClass:'role-admin',
    nav:[
      {section:'Overview', items:[{id:'dashboard',icon:'üìä',label:'Dashboard'},{id:'notifications',icon:'üîî',label:'Notifications',badge:2}]},
      {section:'Management', items:[{id:'students',icon:'üéí',label:'Students'},{id:'teachers',icon:'üë®‚Äçüè´',label:'Teachers'},{id:'classes',icon:'üè´',label:'Classes'},{id:'subjects',icon:'üìö',label:'Subjects'}]},
      {section:'Academic', items:[{id:'scores',icon:'üìù',label:'Scores & Grades'},{id:'attendance',icon:'‚úÖ',label:'Attendance'},{id:'schedule',icon:'üìÖ',label:'Schedule'},{id:'reports',icon:'üìÑ',label:'Report Cards'}]},
      {section:'Finance', items:[{id:'payments',icon:'üí∞',label:'Payments'}]},
      {section:'Account', items:[{id:'profile',icon:'üë§',label:'My Profile'},{id:'settings',icon:'‚öôÔ∏è',label:'Settings'}]}
    ]
  },
  Teacher: {
    color:'linear-gradient(135deg,#3b82f6,#6366f1)', badgeClass:'role-teacher',
    nav:[
      {section:'Overview', items:[{id:'dashboard',icon:'üìä',label:'Dashboard'}]},
      {section:'My Classes', items:[{id:'students',icon:'üéí',label:'Students'},{id:'attendance',icon:'‚úÖ',label:'Attendance'},{id:'scores',icon:'üìù',label:'Scores & Grades'},{id:'schedule',icon:'üìÖ',label:'Schedule'}]},
      {section:'Reports', items:[{id:'reports',icon:'üìÑ',label:'Report Cards'}]},
      {section:'Account', items:[{id:'profile',icon:'üë§',label:'My Profile'}]}
    ]
  },
  Student: {
    color:'linear-gradient(135deg,#10b981,#06b6d4)', badgeClass:'role-student',
    nav:[
      {section:'Overview', items:[{id:'dashboard',icon:'üìä',label:'Dashboard'},{id:'notifications',icon:'üîî',label:'Notifications',badge:1}]},
      {section:'Academic', items:[{id:'scores',icon:'üìù',label:'My Grades'},{id:'attendance',icon:'‚úÖ',label:'My Attendance'},{id:'schedule',icon:'üìÖ',label:'My Schedule'},{id:'reports',icon:'üìÑ',label:'Report Card'}]},
      {section:'Finance', items:[{id:'payments',icon:'üí∞',label:'My Payments'}]},
      {section:'Account', items:[{id:'profile',icon:'üë§',label:'My Profile'}]}
    ]
  }
};

function selectRole(role) {
  currentRole = role;
  document.querySelectorAll('.role-tab').forEach((t,i)=>{
    t.classList.toggle('active', ['Admin','Teacher','Student'][i]===role);
  });
}

function doLogin() {
  const cfg = roleConfigs[currentRole];
  const names = {Admin:'Administrator', Teacher:'Sophea Rin', Student:'Sokha Chea'};
  const initials = {Admin:'A', Teacher:'S', Student:'S'};
  currentUser = {name:names[currentRole], avatar:initials[currentRole], color:cfg.color};

  document.getElementById('loginScreen').style.display='none';
  document.getElementById('app').style.display='flex';
  buildSidebar();
  navigateTo('dashboard');
  showToast('‚úÖ', `Welcome back, ${currentUser.name}!`);
}

function doLogout() {
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('app').style.display='none';
  currentRole = 'Admin';
  document.querySelectorAll('.role-tab').forEach((t,i)=>t.classList.toggle('active',i===0));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SIDEBAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildSidebar() {
  const cfg = roleConfigs[currentRole];
  document.getElementById('sidebarAvatar').textContent = currentUser.avatar;
  document.getElementById('sidebarAvatar').style.background = currentUser.color;
  document.getElementById('sidebarName').textContent = currentUser.name;
  const roleEl = document.getElementById('sidebarRole');
  roleEl.textContent = currentRole;
  roleEl.className = `user-role ${cfg.badgeClass}`;

  const nav = document.getElementById('navMenu');
  nav.innerHTML = cfg.nav.map(section=>`
    <div class="nav-section">
      <div class="nav-label">${section.section}</div>
      ${section.items.map(item=>`
        <button class="nav-item" id="nav-${item.id}" onclick="navigateTo('${item.id}')">
          <span class="nav-icon">${item.icon}</span>
          <span>${item.label}</span>
          ${item.badge?`<span class="nav-badge">${item.badge}</span>`:''}
        </button>
      `).join('')}
    </div>
  `).join('');
}

function navigateTo(page) {
  currentPage = page;
  document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
  const navEl = document.getElementById(`nav-${page}`);
  if(navEl) navEl.classList.add('active');
  renderPage(page);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAGE RENDERER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const pageMeta = {
  dashboard: {title:'Dashboard', subtitle:'Overview & Analytics'},
  students: {title:'Students', subtitle:'Manage student records'},
  teachers: {title:'Teachers', subtitle:'Manage teaching staff'},
  classes: {title:'Classes', subtitle:'Manage class sections'},
  subjects: {title:'Subjects', subtitle:'Manage curriculum subjects'},
  scores: {title:'Scores & Grades', subtitle:'Academic performance tracking'},
  attendance: {title:'Attendance', subtitle:'Track student presence'},
  schedule: {title:'Schedule', subtitle:'Weekly class timetable'},
  reports: {title:'Report Cards', subtitle:'Generate student reports'},
  payments: {title:'Payments', subtitle:'School fee management'},
  notifications: {title:'Notifications', subtitle:'Updates & alerts'},
  profile: {title:'My Profile', subtitle:'Account settings'},
  settings: {title:'Settings', subtitle:'System configuration'},
};

function renderPage(page) {
  const meta = pageMeta[page] || {title:page, subtitle:''};
  document.getElementById('pageTitle').textContent = meta.title;
  document.getElementById('pageSubtitle').textContent = meta.subtitle;
  const content = document.getElementById('pageContent');
  const actions = document.getElementById('topbarActions');
  actions.innerHTML='';

  switch(page) {
    case 'dashboard': content.innerHTML=renderDashboard(); break;
    case 'students': renderStudents(content,actions); break;
    case 'teachers': renderTeachers(content,actions); break;
    case 'classes': renderClasses(content,actions); break;
    case 'subjects': renderSubjects(content,actions); break;
    case 'scores': renderScores(content,actions); break;
    case 'attendance': renderAttendance(content,actions); break;
    case 'schedule': renderSchedule(content); break;
    case 'reports': renderReports(content); break;
    case 'payments': renderPayments(content,actions); break;
    case 'notifications': renderNotifications(content); break;
    case 'profile': renderProfile(content); break;
    case 'settings': renderSettings(content); break;
    default: content.innerHTML=`<div style="text-align:center;padding:60px;color:var(--text3)">Page not found</div>`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  const totalStudents = db.students.length;
  const activeStudents = db.students.filter(s=>s.status==='Active').length;
  const totalTeachers = db.teachers.length;
  const avgGpa = (db.students.reduce((a,s)=>a+s.gpa,0)/totalStudents).toFixed(2);
  const unpaidCount = db.payments.filter(p=>!p.paid).length;

  return `
  <div class="stats-grid">
    <div class="stat-card blue">
      <div class="stat-icon">üéí</div>
      <div class="stat-value">${totalStudents}</div>
      <div class="stat-label">Total Students</div>
      <div class="stat-change up">‚Üë +3 this month</div>
    </div>
    <div class="stat-card purple">
      <div class="stat-icon">üë®‚Äçüè´</div>
      <div class="stat-value">${totalTeachers}</div>
      <div class="stat-label">Teachers</div>
      <div class="stat-change up">‚Üë +1 this month</div>
    </div>
    <div class="stat-card green">
      <div class="stat-icon">‚≠ê</div>
      <div class="stat-value">${avgGpa}</div>
      <div class="stat-label">Average GPA</div>
      <div class="stat-change up">‚Üë 0.2 from last term</div>
    </div>
    <div class="stat-card amber">
      <div class="stat-icon">üí∞</div>
      <div class="stat-value">${unpaidCount}</div>
      <div class="stat-label">Unpaid Fees</div>
      <div class="stat-change down">‚ö† Pending payments</div>
    </div>
  </div>

  <div class="charts-grid">
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìä Student Enrollment per Class</div>
      </div>
      <div class="card-body">
        <div class="chart-bar-wrap">
          ${db.classes.map((c,i)=>{
            const colors=['#3b82f6','#6366f1','#10b981','#f59e0b','#ef4444'];
            const pct = Math.round((c.students/40)*100);
            return `<div class="chart-bar-group">
              <div class="chart-bar-val">${c.students}</div>
              <div class="chart-bar" style="height:${pct}%;background:${colors[i]}" title="${c.name}: ${c.students} students"></div>
              <div class="chart-bar-label">${c.name.replace('Grade ','G')}</div>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="card-title">üç© Grade Distribution</div>
      </div>
      <div class="card-body">
        <div class="donut-wrap">
          <svg class="donut-svg" width="120" height="120" viewBox="0 0 120 120">
            ${makePieCharts([
              {val:25,color:'#10b981'},{val:35,color:'#3b82f6'},
              {val:25,color:'#f59e0b'},{val:15,color:'#ef4444'}
            ])}
          </svg>
          <div class="donut-legend">
            <div class="donut-item"><div class="donut-dot" style="background:#10b981"></div>A (25%)</div>
            <div class="donut-item"><div class="donut-dot" style="background:#3b82f6"></div>B (35%)</div>
            <div class="donut-item"><div class="donut-dot" style="background:#f59e0b"></div>C (25%)</div>
            <div class="donut-item"><div class="donut-dot" style="background:#ef4444"></div>D/F (15%)</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="charts-grid">
    <div class="card">
      <div class="card-header"><div class="card-title">üèÜ Top Students</div></div>
      <div class="card-body" style="padding:0">
        <table><thead><tr><th>#</th><th>Name</th><th>Class</th><th>GPA</th></tr></thead><tbody>
          ${[...db.students].sort((a,b)=>b.gpa-a.gpa).slice(0,5).map((s,i)=>`
            <tr>
              <td><span style="font-weight:700;color:${['#f59e0b','#94a3b8','#cd7c2f','#64748b','#64748b'][i]}">${['ü•á','ü•à','ü•â','4.','5.'][i]}</span></td>
              <td style="font-weight:600;color:var(--text)">${s.name}</td>
              <td>${s.class}</td>
              <td><span style="color:var(--accent3);font-family:'JetBrains Mono',monospace;font-weight:700">${s.gpa}</span></td>
            </tr>
          `).join('')}
        </tbody></table>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">‚ö° Recent Activity</div></div>
      <div class="card-body" style="padding:0">
        <div class="notif-item"><div class="notif-icon" style="background:rgba(59,130,246,0.15)">üìã</div><div class="notif-content"><div class="notif-title">New Student Registered</div><div class="notif-text">Channary Keo enrolled in Grade 10B</div><div class="notif-time">5 min ago</div></div></div>
        <div class="notif-item"><div class="notif-icon" style="background:rgba(16,185,129,0.15)">‚úÖ</div><div class="notif-content"><div class="notif-title">Attendance Recorded</div><div class="notif-text">Grade 11B attendance saved for today</div><div class="notif-time">1h ago</div></div></div>
        <div class="notif-item"><div class="notif-icon" style="background:rgba(245,158,11,0.15)">üìù</div><div class="notif-content"><div class="notif-title">Scores Updated</div><div class="notif-text">Mathematics midterm scores entered</div><div class="notif-time">3h ago</div></div></div>
        <div class="notif-item"><div class="notif-icon" style="background:rgba(239,68,68,0.15)">üí∞</div><div class="notif-content"><div class="notif-title">Payment Received</div><div class="notif-text">Sokha Chea paid Feb tuition ($45)</div><div class="notif-time">5h ago</div></div></div>
      </div>
    </div>
  </div>`;
}

function makePieCharts(data) {
  const cx=60,cy=60,r=50,ri=30;
  let svgs=''; let cumAngle=-Math.PI/2;
  const total=data.reduce((a,d)=>a+d.val,0);
  data.forEach(d=>{
    const angle=(d.val/total)*Math.PI*2;
    const x1=cx+r*Math.cos(cumAngle), y1=cy+r*Math.sin(cumAngle);
    const x2=cx+r*Math.cos(cumAngle+angle), y2=cy+r*Math.sin(cumAngle+angle);
    const xi1=cx+ri*Math.cos(cumAngle), yi1=cy+ri*Math.sin(cumAngle);
    const xi2=cx+ri*Math.cos(cumAngle+angle), yi2=cy+ri*Math.sin(cumAngle+angle);
    const lg=angle>Math.PI?1:0;
    svgs+=`<path d="M${x1},${y1} A${r},${r} 0 ${lg} 1 ${x2},${y2} L${xi2},${yi2} A${ri},${ri} 0 ${lg} 0 ${xi1},${yi1} Z" fill="${d.color}" opacity="0.85"/>`;
    cumAngle+=angle;
  });
  return svgs;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STUDENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStudents(content, actions) {
  if(currentRole!=='Student') {
    actions.innerHTML=`<button class="btn btn-blue" onclick="openAddStudent()">‚ûï Add Student</button>
      <button class="btn btn-ghost" onclick="showToast('üìä','Export feature coming soon!')">üì§ Export</button>`;
  }
  content.innerHTML=`
    <div class="search-bar">
      <div class="search-wrap"><span class="search-icon">üîç</span><input type="text" placeholder="Search students..." oninput="filterStudents(this.value)"></div>
      <select class="filter-select" onchange="filterStudents(document.querySelector('.search-wrap input').value,this.value)">
        <option value="">All Classes</option>
        ${db.classes.map(c=>`<option>${c.name}</option>`).join('')}
      </select>
      <select class="filter-select" onchange="filterStudents(document.querySelector('.search-wrap input').value,'',this.value)">
        <option value="">All Status</option>
        <option>Active</option><option>Inactive</option>
      </select>
    </div>
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table id="studentsTable">
            <thead><tr>
              <th>ID</th><th>Name</th><th>Gender</th><th>Class</th><th>GPA</th><th>Phone</th><th>Status</th>
              ${currentRole!=='Student'?'<th>Actions</th>':''}
            </tr></thead>
            <tbody id="studentsTbody">${renderStudentRows(db.students)}</tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function renderStudentRows(students) {
  if(!students.length) return `<tr><td colspan="8" style="text-align:center;padding:40px;color:var(--text3)">No students found</td></tr>`;
  return students.map(s=>`
    <tr>
      <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent)">${s.id}</span></td>
      <td style="font-weight:600;color:var(--text)">${s.name}</td>
      <td>${s.gender==='Male'?'‚ôÇÔ∏è':'‚ôÄÔ∏è'} ${s.gender}</td>
      <td><span class="badge badge-blue">${s.class}</span></td>
      <td><span style="font-family:'JetBrains Mono',monospace;color:${s.gpa>=3.5?'#34d399':s.gpa>=3?'#fbbf24':'#f87171'};font-weight:700">${s.gpa}</span></td>
      <td style="font-size:12px">${s.phone}</td>
      <td><span class="badge ${s.status==='Active'?'badge-green':'badge-red'}">${s.status}</span></td>
      ${currentRole!=='Student'?`<td>
        <button class="btn btn-sm btn-ghost" onclick="viewStudent('${s.id}')">üëÅ View</button>
        <button class="btn btn-sm btn-blue" onclick="editStudent('${s.id}')" style="margin-left:4px">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-red" onclick="deleteStudent('${s.id}')" style="margin-left:4px">üóë</button>
      </td>`:''}
    </tr>
  `).join('');
}

function filterStudents(q='', cls='', status='') {
  const filtered = db.students.filter(s=>{
    const matchQ = !q || s.name.toLowerCase().includes(q.toLowerCase()) || s.id.includes(q);
    const matchCls = !cls || s.class===cls;
    const matchStatus = !status || s.status===status;
    return matchQ && matchCls && matchStatus;
  });
  document.getElementById('studentsTbody').innerHTML = renderStudentRows(filtered);
}

function openAddStudent() {
  document.getElementById('modalTitle').textContent='Add New Student';
  document.getElementById('modalBody').innerHTML=`
    <div class="form-row">
      <div class="form-group"><label>Full Name *</label><input id="fn" placeholder="Student name..."></div>
      <div class="form-group"><label>Student ID</label><input id="fid" placeholder="Auto-generated" readonly style="opacity:0.5" value="S00${db.students.length+1}"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Gender *</label><select id="fg"><option>Male</option><option>Female</option></select></div>
      <div class="form-group"><label>Date of Birth</label><input id="fdob" type="date"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Class *</label><select id="fcls">${db.classes.map(c=>`<option>${c.name}</option>`).join('')}</select></div>
      <div class="form-group"><label>Phone</label><input id="fph" placeholder="0xx-xxx-xxx"></div>
    </div>
    <div class="form-group"><label>Email</label><input id="fem" type="email" placeholder="student@edu.kh"></div>
    <div class="form-group"><label>Address</label><textarea id="fadr" placeholder="Home address..."></textarea></div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="saveStudent()">üíæ Save Student</button>
  `;
  openModal();
}

function saveStudent() {
  const name=document.getElementById('fn').value.trim();
  if(!name){showToast('‚ùå','Please enter student name!');return;}
  const s={
    id:`S00${db.students.length+1}`, name,
    gender:document.getElementById('fg').value,
    dob:document.getElementById('fdob').value||'2008-01-01',
    class:document.getElementById('fcls').value,
    phone:document.getElementById('fph').value||'N/A',
    email:document.getElementById('fem').value||'N/A',
    gpa:0.0, status:'Active',
    address:document.getElementById('fadr').value||'N/A'
  };
  db.students.push(s);
  closeModal();
  navigateTo('students');
  showToast('‚úÖ',`Student "${name}" added successfully!`);
}

function viewStudent(id) {
  const s=db.students.find(x=>x.id===id);
  document.getElementById('modalTitle').textContent=`Student Profile ‚Äî ${s.name}`;
  document.getElementById('modalBody').innerHTML=`
    <div style="text-align:center;margin-bottom:20px">
      <div style="width:72px;height:72px;border-radius:18px;background:linear-gradient(135deg,#3b82f6,#6366f1);display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto 12px">${s.gender==='Male'?'üë¶':'üëß'}</div>
      <h3 style="font-size:18px;font-weight:700">${s.name}</h3>
      <p style="color:var(--text3);font-size:13px">${s.id} ¬∑ ${s.class}</p>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
      ${[['Gender',s.gender],['Date of Birth',s.dob],['Phone',s.phone],['Email',s.email],['Address',s.address],['GPA',s.gpa],['Status',s.status]].map(([k,v])=>`
        <div style="padding:12px;background:var(--surface2);border-radius:10px">
          <div style="font-size:11px;color:var(--text3);margin-bottom:4px;text-transform:uppercase;font-weight:600">${k}</div>
          <div style="font-size:13px;font-weight:600">${v}</div>
        </div>
      `).join('')}
    </div>
  `;
  document.getElementById('modalFooter').innerHTML=`<button class="btn btn-ghost" onclick="closeModal()">Close</button>`;
  openModal();
}

function editStudent(id) {
  const s=db.students.find(x=>x.id===id);
  document.getElementById('modalTitle').textContent=`Edit Student ‚Äî ${s.name}`;
  document.getElementById('modalBody').innerHTML=`
    <div class="form-row">
      <div class="form-group"><label>Full Name</label><input id="fen" value="${s.name}"></div>
      <div class="form-group"><label>Gender</label><select id="feg"><option ${s.gender==='Male'?'selected':''}>Male</option><option ${s.gender==='Female'?'selected':''}>Female</option></select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Class</label><select id="fecls">${db.classes.map(c=>`<option ${c.name===s.class?'selected':''}>${c.name}</option>`).join('')}</select></div>
      <div class="form-group"><label>Status</label><select id="fest"><option ${s.status==='Active'?'selected':''}>Active</option><option ${s.status==='Inactive'?'selected':''}>Inactive</option></select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Phone</label><input id="feph" value="${s.phone}"></div>
      <div class="form-group"><label>Email</label><input id="feem" value="${s.email}"></div>
    </div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="updateStudent('${id}')">üíæ Update</button>
  `;
  openModal();
}

function updateStudent(id) {
  const s=db.students.find(x=>x.id===id);
  s.name=document.getElementById('fen').value;
  s.gender=document.getElementById('feg').value;
  s.class=document.getElementById('fecls').value;
  s.status=document.getElementById('fest').value;
  s.phone=document.getElementById('feph').value;
  s.email=document.getElementById('feem').value;
  closeModal();
  navigateTo('students');
  showToast('‚úÖ',`Student "${s.name}" updated!`);
}

function deleteStudent(id) {
  const s=db.students.find(x=>x.id===id);
  if(confirm(`Delete student "${s.name}"?`)){
    db.students=db.students.filter(x=>x.id!==id);
    navigateTo('students');
    showToast('üóë',`Student "${s.name}" deleted.`);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TEACHERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTeachers(content, actions) {
  actions.innerHTML=`<button class="btn btn-blue" onclick="openAddTeacher()">‚ûï Add Teacher</button>`;
  content.innerHTML=`
    <div class="search-bar">
      <div class="search-wrap"><span class="search-icon">üîç</span><input type="text" placeholder="Search teachers..." oninput="filterTeachers(this.value)"></div>
    </div>
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>ID</th><th>Name</th><th>Gender</th><th>Subject</th><th>Phone</th><th>Hire Date</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody id="teachersTbody">${renderTeacherRows(db.teachers)}</tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function renderTeacherRows(teachers) {
  return teachers.map(t=>`
    <tr>
      <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent2)">${t.id}</span></td>
      <td style="font-weight:600;color:var(--text)">${t.name}</td>
      <td>${t.gender==='Male'?'‚ôÇÔ∏è':'‚ôÄÔ∏è'} ${t.gender}</td>
      <td><span class="badge badge-purple">${t.subject}</span></td>
      <td style="font-size:12px">${t.phone}</td>
      <td style="font-size:12px;font-family:'JetBrains Mono',monospace">${t.hire}</td>
      <td><span class="badge ${t.status==='Active'?'badge-green':'badge-red'}">${t.status}</span></td>
      <td>
        <button class="btn btn-sm btn-ghost" onclick="showToast('üë®‚Äçüè´','View teacher profile')">üëÅ</button>
        <button class="btn btn-sm btn-blue" onclick="showToast('‚úèÔ∏è','Edit teacher details')" style="margin-left:4px">‚úèÔ∏è</button>
      </td>
    </tr>
  `).join('');
}

function filterTeachers(q) {
  const filtered=db.teachers.filter(t=>t.name.toLowerCase().includes(q.toLowerCase())||t.subject.toLowerCase().includes(q.toLowerCase()));
  document.getElementById('teachersTbody').innerHTML=renderTeacherRows(filtered);
}

function openAddTeacher() {
  document.getElementById('modalTitle').textContent='Add New Teacher';
  document.getElementById('modalBody').innerHTML=`
    <div class="form-row">
      <div class="form-group"><label>Full Name *</label><input id="tfn" placeholder="Teacher name..."></div>
      <div class="form-group"><label>Gender</label><select id="tfg"><option>Male</option><option>Female</option></select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Subject *</label><select id="tfsub">${db.subjects.map(s=>`<option>${s.name}</option>`).join('')}</select></div>
      <div class="form-group"><label>Phone</label><input id="tfph" placeholder="0xx-xxx-xxx"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email</label><input id="tfem" type="email" placeholder="teacher@edu.kh"></div>
      <div class="form-group"><label>Hire Date</label><input id="tfhire" type="date"></div>
    </div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="saveTeacher()">üíæ Save Teacher</button>
  `;
  openModal();
}

function saveTeacher() {
  const name=document.getElementById('tfn').value.trim();
  if(!name){showToast('‚ùå','Please enter teacher name!');return;}
  db.teachers.push({
    id:`T00${db.teachers.length+1}`, name,
    gender:document.getElementById('tfg').value,
    subject:document.getElementById('tfsub').value,
    phone:document.getElementById('tfph').value||'N/A',
    email:document.getElementById('tfem').value||'N/A',
    status:'Active', hire:document.getElementById('tfhire').value||new Date().toISOString().split('T')[0]
  });
  closeModal();
  navigateTo('teachers');
  showToast('‚úÖ',`Teacher "${name}" added!`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CLASSES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderClasses(content, actions) {
  actions.innerHTML=`<button class="btn btn-blue" onclick="openAddClass()">‚ûï Add Class</button>`;
  content.innerHTML=`
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>ID</th><th>Class Name</th><th>Class Teacher</th><th>Students</th><th>Room</th><th>Year</th><th>Actions</th></tr></thead>
          <tbody>
            ${db.classes.map(c=>`
              <tr>
                <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent3)">${c.id}</span></td>
                <td style="font-weight:700;color:var(--text)">${c.name}</td>
                <td>${c.teacher}</td>
                <td><div style="display:flex;align-items:center;gap:8px">
                  <div style="flex:1;height:6px;background:var(--surface3);border-radius:3px;max-width:80px">
                    <div style="height:100%;border-radius:3px;background:var(--accent);width:${Math.round(c.students/40*100)}%"></div>
                  </div>
                  <span style="font-family:'JetBrains Mono',monospace;font-weight:600">${c.students}</span>
                </div></td>
                <td><span class="badge badge-amber">${c.room}</span></td>
                <td style="font-size:12px">${c.year}</td>
                <td>
                  <button class="btn btn-sm btn-ghost" onclick="showToast('üè´','View class details')">üëÅ</button>
                  <button class="btn btn-sm btn-blue" onclick="showToast('‚úèÔ∏è','Edit class')" style="margin-left:4px">‚úèÔ∏è</button>
                </td>
              </tr>
            `).join('')}
          </tbody></table>
        </div>
      </div>
    </div>
  `;
}

function openAddClass() {
  document.getElementById('modalTitle').textContent='Add New Class';
  document.getElementById('modalBody').innerHTML=`
    <div class="form-row">
      <div class="form-group"><label>Class Name *</label><input id="cfn" placeholder="e.g. Grade 12A"></div>
      <div class="form-group"><label>Room</label><input id="cfr" placeholder="e.g. Room 401"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Class Teacher</label><select id="cft">${db.teachers.map(t=>`<option>${t.name}</option>`).join('')}</select></div>
      <div class="form-group"><label>Academic Year</label><input id="cfy" value="2025-2026"></div>
    </div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="saveClass()">üíæ Save Class</button>
  `;
  openModal();
}

function saveClass() {
  const name=document.getElementById('cfn').value.trim();
  if(!name){showToast('‚ùå','Please enter class name!');return;}
  db.classes.push({id:`C00${db.classes.length+1}`,name,teacher:document.getElementById('cft').value,students:0,room:document.getElementById('cfr').value,year:document.getElementById('cfy').value});
  closeModal(); navigateTo('classes');
  showToast('‚úÖ',`Class "${name}" created!`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SUBJECTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSubjects(content, actions) {
  actions.innerHTML=`<button class="btn btn-blue" onclick="showToast('üìö','Add subject feature')">‚ûï Add Subject</button>`;
  content.innerHTML=`
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>Code</th><th>Subject Name</th><th>Teacher</th><th>Credits</th><th>Classes</th><th>Type</th></tr></thead>
          <tbody>
            ${db.subjects.map(s=>`
              <tr>
                <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent4);font-weight:700">${s.code}</span></td>
                <td style="font-weight:600;color:var(--text)">${s.name}</td>
                <td>${s.teacher}</td>
                <td><span class="badge badge-blue">${s.credits} credits</span></td>
                <td style="font-size:12px;color:var(--text2)">${s.classes}</td>
                <td><span class="badge ${s.type==='Core'?'badge-purple':'badge-amber'}">${s.type}</span></td>
              </tr>
            `).join('')}
          </tbody></table>
        </div>
      </div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCORES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderScores(content, actions) {
  if(currentRole!=='Student') {
    actions.innerHTML=`<button class="btn btn-blue" onclick="openAddScore()">‚ûï Add Score</button>`;
  }
  const studentFilter = currentRole==='Student' ? db.scores.filter(s=>s.student==='Sokha Chea') : db.scores;
  content.innerHTML=`
    ${currentRole==='Student'?`
      <div class="card" style="margin-bottom:16px">
        <div class="card-header"><div class="card-title">üìä My Grade Overview ‚Äî Sokha Chea</div></div>
        <div class="card-body">
          ${studentFilter.map(s=>{
            const pct=s.total; const color=pct>=90?'#10b981':pct>=80?'#3b82f6':pct>=70?'#f59e0b':'#ef4444';
            return `<div class="grade-display">
              <div class="grade-subject">${s.subject}</div>
              <div class="grade-bar-bg"><div class="grade-bar-fill" style="width:${pct}%;background:${color}"></div></div>
              <div class="grade-score" style="color:${color}">${s.total}</div>
              <div class="grade-letter" style="background:${color}22;color:${color}">${s.grade}</div>
            </div>`;
          }).join('')}
        </div>
      </div>
    `:''}
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>Student</th><th>Class</th><th>Subject</th><th>Midterm</th><th>Final</th><th>Assign.</th><th>Total</th><th>Grade</th></tr></thead>
          <tbody>
            ${studentFilter.map(s=>`
              <tr>
                <td style="font-weight:600;color:var(--text)">${s.student}</td>
                <td><span class="badge badge-blue">${s.class}</span></td>
                <td>${s.subject}</td>
                <td style="font-family:'JetBrains Mono',monospace">${s.midterm}</td>
                <td style="font-family:'JetBrains Mono',monospace">${s.final}</td>
                <td style="font-family:'JetBrains Mono',monospace">${s.assignments}</td>
                <td style="font-family:'JetBrains Mono',monospace;font-weight:700;color:${s.total>=90?'#34d399':s.total>=80?'#60a5fa':s.total>=70?'#fbbf24':'#f87171'}">${s.total}</td>
                <td><span class="badge ${s.total>=90?'badge-green':s.total>=80?'badge-blue':s.total>=70?'badge-amber':'badge-red'}">${s.grade}</span></td>
              </tr>
            `).join('')}
          </tbody></table>
        </div>
      </div>
    </div>
  `;
}

function openAddScore() {
  document.getElementById('modalTitle').textContent='Enter Score';
  document.getElementById('modalBody').innerHTML=`
    <div class="form-row">
      <div class="form-group"><label>Student</label><select id="scs">${db.students.map(s=>`<option>${s.name}</option>`).join('')}</select></div>
      <div class="form-group"><label>Subject</label><select id="scsub">${db.subjects.map(s=>`<option>${s.name}</option>`).join('')}</select></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Midterm (0-100)</label><input id="scm" type="number" min="0" max="100" placeholder="0"></div>
      <div class="form-group"><label>Final (0-100)</label><input id="scf" type="number" min="0" max="100" placeholder="0"></div>
    </div>
    <div class="form-group"><label>Assignments (0-100)</label><input id="sca" type="number" min="0" max="100" placeholder="0"></div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="saveScore()">üíæ Save Score</button>
  `;
  openModal();
}

function saveScore() {
  const m=parseInt(document.getElementById('scm').value)||0;
  const f=parseInt(document.getElementById('scf').value)||0;
  const a=parseInt(document.getElementById('sca').value)||0;
  const total=Math.round(m*0.3+f*0.5+a*0.2);
  const grade=total>=90?'A+':total>=85?'A':total>=80?'B+':total>=75?'B':total>=70?'B-':total>=65?'C+':total>=60?'C':'D';
  const student=document.getElementById('scs').value;
  const subject=document.getElementById('scsub').value;
  db.scores.push({id:`SC0${db.scores.length+1}`,student,class:'Grade 10A',subject,midterm:m,final:f,assignments:a,total,grade});
  closeModal(); navigateTo('scores');
  showToast('‚úÖ',`Score saved for ${student}!`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ATTENDANCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAttendance(content, actions) {
  const student = currentRole==='Student' ? db.students[0] : db.students[0];
  const attData = db.attendance['S001'] || [];
  const days=['Mon','Tue','Wed','Thu','Fri','Mon','Tue','Wed','Thu','Fri','Mon','Tue','Wed','Thu','Fri','Mon','Tue','Wed','Thu','Fri'];
  const present=attData.filter(x=>x===1).length;
  const absent=attData.filter(x=>x===0).length;
  const late=attData.filter(x=>x===2).length;

  if(currentRole!=='Student') {
    actions.innerHTML=`<button class="btn btn-blue" onclick="showToast('‚úÖ','Mark attendance')">üìã Mark Today</button>`;
  }

  content.innerHTML=`
    <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:20px">
      <div class="stat-card green"><div class="stat-icon">‚úÖ</div><div class="stat-value">${present}</div><div class="stat-label">Present Days</div></div>
      <div class="stat-card" style="--border:#ef4444"><div class="stat-icon">‚ùå</div><div class="stat-value" style="color:var(--danger)">${absent}</div><div class="stat-label">Absent Days</div></div>
      <div class="stat-card amber"><div class="stat-icon">‚è∞</div><div class="stat-value" style="color:var(--accent4)">${late}</div><div class="stat-label">Late Days</div></div>
    </div>
    <div class="card" style="margin-bottom:16px">
      <div class="card-header">
        <div class="card-title">üìÖ February 2026 ‚Äî ${currentRole==='Student'?currentUser.name:'Sokha Chea'}</div>
        <div style="display:flex;gap:12px;font-size:12px">
          <span style="color:var(--accent3)">‚óè Present</span>
          <span style="color:var(--danger)">‚óè Absent</span>
          <span style="color:var(--accent4)">‚óè Late</span>
        </div>
      </div>
      <div class="card-body">
        <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px">
          ${days.map((d,i)=>{
            const type=['present','absent','present','late','present'][attData[i]===undefined?0:attData[i]];
            const num=i+1;
            return `<div class="att-day">
              <div class="att-day-name">${d}</div>
              <div class="att-cell ${attData[i]===1?'present':attData[i]===0?'absent':'late'}" 
                onclick="toggleAttendance(this)" title="${d} ${num}">${num}</div>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>
    ${currentRole!=='Student'?`
    <div class="card">
      <div class="card-header"><div class="card-title">üë• Class Attendance Summary ‚Äî Grade 10A</div></div>
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>Student</th><th>Present</th><th>Absent</th><th>Late</th><th>Rate</th></tr></thead>
          <tbody>
            ${db.students.slice(0,5).map(s=>{
              const p=Math.floor(Math.random()*5)+15;const a=Math.floor(Math.random()*3);const l=Math.floor(Math.random()*2);
              const rate=Math.round(p/(p+a+l)*100);
              return `<tr>
                <td style="font-weight:600;color:var(--text)">${s.name}</td>
                <td style="color:var(--accent3);font-weight:600">${p}</td>
                <td style="color:var(--danger);font-weight:600">${a}</td>
                <td style="color:var(--accent4);font-weight:600">${l}</td>
                <td><span class="badge ${rate>=90?'badge-green':rate>=75?'badge-amber':'badge-red'}">${rate}%</span></td>
              </tr>`;
            }).join('')}
          </tbody></table>
        </div>
      </div>
    </div>`:''}
  `;
}

function toggleAttendance(el) {
  if(el.classList.contains('present')){ el.className='att-cell absent'; }
  else if(el.classList.contains('absent')){ el.className='att-cell late'; }
  else { el.className='att-cell present'; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCHEDULE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSchedule(content) {
  const times=['08:00','09:00','10:00','11:00','12:00','13:00','14:00','15:00'];
  const schedule = [
    ['Math\nRoom 201','Physics\nRoom 301','','English\nRoom 202','Math\nRoom 201'],
    ['Khmer\nRoom 101','Math\nRoom 201','Physics\nRoom 301','','Khmer\nRoom 101'],
    ['English\nRoom 202','','Math\nRoom 201','Khmer\nRoom 101','Physics\nRoom 301'],
    ['','Khmer\nRoom 101','English\nRoom 202','Math\nRoom 201',''],
    ['Physics\nRoom 301','English\nRoom 202','','','Math\nRoom 201'],
    ['','','Khmer\nRoom 101','Physics\nRoom 301','English\nRoom 202'],
    ['Math\nRoom 201','','','English\nRoom 202',''],
    ['','Physics\nRoom 301','Math\nRoom 201','','Khmer\nRoom 101'],
  ];
  const clsColors=['blue','green','','purple','blue'];
  const days=['Monday','Tuesday','Wednesday','Thursday','Friday'];

  content.innerHTML=`
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìÖ Weekly Timetable ‚Äî Grade 10A</div>
        <div style="display:flex;gap:12px;font-size:12px">
          <span style="color:var(--accent)">‚óè Math</span>
          <span style="color:var(--accent3)">‚óè Physics</span>
          <span style="color:var(--accent2)">‚óè English</span>
          <span style="color:var(--accent4)">‚óè Khmer</span>
        </div>
      </div>
      <div class="card-body">
        <div style="overflow-x:auto">
          <div class="schedule-grid" style="min-width:600px">
            <div class="sch-header"></div>
            ${days.map(d=>`<div class="sch-header">${d}</div>`).join('')}
            ${times.map((t,ti)=>`
              <div class="sch-time">${t}</div>
              ${schedule[ti].map((s,di)=>{
                if(!s) return `<div class="sch-cell"></div>`;
                const parts=s.split('\n');
                const colors={Math:'blue',Physics:'green',English:'purple',Khmer:'amber'};
                const cls=Object.keys(colors).find(k=>parts[0].includes(k))||'blue';
                return `<div class="sch-cell has-class ${colors[cls]}">
                  <div class="sch-class-name">${parts[0]}</div>
                  <div class="sch-class-room">${parts[1]||''}</div>
                </div>`;
              }).join('')}
            `).join('')}
          </div>
        </div>
      </div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  REPORT CARDS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderReports(content) {
  content.innerHTML=`
    <div class="search-bar">
      <div class="search-wrap"><span class="search-icon">üîç</span>
        <input type="text" placeholder="Search student..." id="reportSearch" oninput="filterReportStudent(this.value)">
      </div>
      <select class="filter-select" id="reportClass">
        <option value="">All Classes</option>
        ${db.classes.map(c=>`<option>${c.name}</option>`).join('')}
      </select>
    </div>
    <div id="reportCardContainer">
      ${renderReportCard(db.students[0])}
    </div>
  `;
}

function filterReportStudent(q) {
  const s=db.students.find(x=>x.name.toLowerCase().includes(q.toLowerCase()));
  if(s) document.getElementById('reportCardContainer').innerHTML=renderReportCard(s);
}

function renderReportCard(student) {
  const studentScores = db.scores.filter(s=>s.student===student.name);
  const avg = studentScores.length ? Math.round(studentScores.reduce((a,s)=>a+s.total,0)/studentScores.length) : 0;
  const rank = [...db.students].sort((a,b)=>b.gpa-a.gpa).findIndex(s=>s.id===student.id)+1;

  return `
    <div class="report-card">
      <div class="report-header">
        <div class="report-logo">üéì</div>
        <div class="report-school">
          <h2>VannEdu International School</h2>
          <p>Academic Year 2025-2026 | Semester 2 Report Card</p>
        </div>
        <div style="margin-left:auto;text-align:right">
          <div style="font-size:12px;color:var(--text3)">Printed</div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:13px">${new Date().toLocaleDateString()}</div>
        </div>
      </div>
      <div class="report-student-info">
        <div class="report-info-item"><label>Student Name</label><span>${student.name}</span></div>
        <div class="report-info-item"><label>Student ID</label><span>${student.id}</span></div>
        <div class="report-info-item"><label>Class</label><span>${student.class}</span></div>
        <div class="report-info-item"><label>Gender</label><span>${student.gender}</span></div>
      </div>
      <div class="report-table">
        <table><thead><tr><th>Subject</th><th>Midterm</th><th>Final</th><th>Assignments</th><th>Total</th><th>Grade</th><th>Remarks</th></tr></thead>
        <tbody>
          ${studentScores.length ? studentScores.map(s=>`
            <tr>
              <td style="font-weight:600;color:var(--text)">${s.subject}</td>
              <td style="font-family:'JetBrains Mono',monospace">${s.midterm}</td>
              <td style="font-family:'JetBrains Mono',monospace">${s.final}</td>
              <td style="font-family:'JetBrains Mono',monospace">${s.assignments}</td>
              <td style="font-family:'JetBrains Mono',monospace;font-weight:700">${s.total}</td>
              <td><span class="badge ${s.total>=90?'badge-green':s.total>=80?'badge-blue':s.total>=70?'badge-amber':'badge-red'}">${s.grade}</span></td>
              <td style="font-size:12px;color:var(--text3)">${s.total>=90?'Excellent':s.total>=80?'Very Good':s.total>=70?'Good':s.total>=60?'Average':'Needs Improvement'}</td>
            </tr>
          `).join('') : `<tr><td colspan="7" style="text-align:center;padding:30px;color:var(--text3)">No scores recorded yet</td></tr>`}
        </tbody></table>
      </div>
      <div class="report-summary">
        <div class="report-summary-item">
          <div class="val" style="color:var(--accent)">${avg}%</div>
          <div class="lbl">Average Score</div>
        </div>
        <div class="report-summary-item">
          <div class="val" style="color:var(--accent3)">${student.gpa}</div>
          <div class="lbl">GPA</div>
        </div>
        <div class="report-summary-item">
          <div class="val" style="color:var(--accent4)">#${rank}</div>
          <div class="lbl">Class Rank</div>
        </div>
      </div>
      <div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:12px;color:var(--text3)">
        <div>Class Teacher: <span style="color:var(--text);font-weight:600">Sophea Rin</span></div>
        <div>Principal: <span style="color:var(--text);font-weight:600">Dr. Sokha Pich</span></div>
        <button class="btn btn-sm btn-blue" onclick="printReport()">üñ®Ô∏è Print</button>
      </div>
    </div>
  `;
}

function printReport() {
  window.print();
  showToast('üñ®Ô∏è','Sending to printer...');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PAYMENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderPayments(content, actions) {
  if(currentRole!=='Student') {
    actions.innerHTML=`<button class="btn btn-blue" onclick="openAddPayment()">‚ûï Record Payment</button>`;
  }
  const myPayments = currentRole==='Student' ? db.payments.filter(p=>p.student==='Sokha Chea') : db.payments;
  const totalPaid=myPayments.filter(p=>p.paid).reduce((a,p)=>a+p.amount,0);
  const totalUnpaid=myPayments.filter(p=>!p.paid).reduce((a,p)=>a+p.amount,0);

  content.innerHTML=`
    <div class="stats-grid" style="grid-template-columns:repeat(3,1fr);margin-bottom:20px">
      <div class="stat-card green"><div class="stat-icon">üíö</div><div class="stat-value">$${totalPaid}</div><div class="stat-label">Total Paid</div></div>
      <div class="stat-card" style><div class="stat-icon">‚è≥</div><div class="stat-value" style="color:var(--accent4)">$${totalUnpaid}</div><div class="stat-label">Pending</div></div>
      <div class="stat-card blue"><div class="stat-icon">üìä</div><div class="stat-value">${myPayments.length}</div><div class="stat-label">Total Records</div></div>
    </div>
    <div class="card">
      <div class="card-body" style="padding:0">
        <div class="table-wrap">
          <table><thead><tr><th>ID</th><th>Student</th><th>Month</th><th>Amount</th><th>Status</th><th>Date Paid</th>${currentRole!=='Student'?'<th>Actions</th>':''}</tr></thead>
          <tbody>
            ${myPayments.map(p=>`
              <tr>
                <td><span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--accent)">${p.id}</span></td>
                <td style="font-weight:600;color:var(--text)">${p.student}</td>
                <td>${p.month}</td>
                <td style="font-family:'JetBrains Mono',monospace;color:var(--accent4);font-weight:700">$${p.amount}</td>
                <td><span class="badge ${p.paid?'badge-green':'badge-red'}">${p.paid?'‚úÖ Paid':'‚ùå Unpaid'}</span></td>
                <td style="font-size:12px;font-family:'JetBrains Mono',monospace">${p.date||'‚Äî'}</td>
                ${currentRole!=='Student'?`<td>
                  ${!p.paid?`<button class="btn btn-sm btn-green" onclick="markPaid('${p.id}')">‚úÖ Mark Paid</button>`:'<span style="color:var(--text3);font-size:12px">Completed</span>'}
                </td>`:''}
              </tr>
            `).join('')}
          </tbody></table>
        </div>
      </div>
    </div>
  `;
}

function markPaid(id) {
  const p=db.payments.find(x=>x.id===id);
  p.paid=true; p.date=new Date().toISOString().split('T')[0];
  navigateTo('payments');
  showToast('üí∞',`Payment for ${p.student} marked as paid!`);
}

function openAddPayment() {
  document.getElementById('modalTitle').textContent='Record Payment';
  document.getElementById('modalBody').innerHTML=`
    <div class="form-group"><label>Student</label><select id="pst">${db.students.map(s=>`<option>${s.name}</option>`).join('')}</select></div>
    <div class="form-row">
      <div class="form-group"><label>Month</label><input id="pmon" placeholder="e.g. March 2026"></div>
      <div class="form-group"><label>Amount ($)</label><input id="pamt" type="number" value="45"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Status</label><select id="pstatus"><option value="true">Paid</option><option value="false">Unpaid</option></select></div>
      <div class="form-group"><label>Date</label><input id="pdate" type="date" value="${new Date().toISOString().split('T')[0]}"></div>
    </div>
  `;
  document.getElementById('modalFooter').innerHTML=`
    <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
    <button class="btn btn-blue" onclick="savePayment()">üíæ Save</button>
  `;
  openModal();
}

function savePayment() {
  const student=document.getElementById('pst').value;
  const paid=document.getElementById('pstatus').value==='true';
  db.payments.push({id:`P0${db.payments.length+1}`,student,month:document.getElementById('pmon').value,amount:parseInt(document.getElementById('pamt').value),paid,date:paid?document.getElementById('pdate').value:null});
  closeModal(); navigateTo('payments');
  showToast('üí∞','Payment recorded successfully!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  NOTIFICATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderNotifications(content) {
  content.innerHTML=`
    <div class="card">
      <div class="card-header">
        <div class="card-title">üîî All Notifications</div>
        <button class="btn btn-sm btn-ghost" onclick="markAllRead()">‚úì Mark all read</button>
      </div>
      <div id="notifList">
        ${db.notifications.map(n=>`
          <div class="notif-item" id="notif-${n.id}" style="${!n.read?'background:rgba(59,130,246,0.04)':''}">
            <div class="notif-icon" style="background:rgba(${n.type==='info'?'59,130,246':n.type==='warning'?'245,158,11':n.type==='success'?'16,185,129':'239,68,68'},0.15)">${n.icon}</div>
            <div class="notif-content" style="flex:1">
              <div class="notif-title">${n.title}</div>
              <div class="notif-text">${n.text}</div>
              <div class="notif-time">${n.time}</div>
            </div>
            ${!n.read?`<div class="notif-dot"></div>`:''}
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

function markAllRead() {
  db.notifications.forEach(n=>n.read=true);
  renderNotifications(document.getElementById('pageContent'));
  showToast('‚úÖ','All notifications marked as read!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PROFILE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderProfile(content) {
  const isStudent=currentRole==='Student';
  const data=isStudent?db.students[0]:{name:currentUser.name,id:'ADM001',email:'admin@edu.kh',phone:'012-000-001',address:'Phnom Penh',status:'Active'};

  content.innerHTML=`
    <div class="profile-header">
      <div class="profile-avatar" style="background:${currentUser.color}">${currentUser.avatar}</div>
      <div class="profile-info">
        <h3>${currentUser.name}</h3>
        <p>${data.email||'N/A'} ¬∑ ${data.phone||'N/A'}</p>
        <div class="profile-tags">
          <span class="badge badge-blue">${currentRole}</span>
          ${isStudent?`<span class="badge badge-green">${data.class}</span>`:''}
          <span class="badge badge-green">Active</span>
        </div>
      </div>
      <button class="btn btn-blue" onclick="showToast('‚úèÔ∏è','Edit profile feature')" style="margin-left:auto">‚úèÔ∏è Edit Profile</button>
    </div>
    <div class="profile-grid">
      <div class="card">
        <div class="card-header"><div class="card-title">üë§ Personal Information</div></div>
        <div class="card-body">
          ${[['Full Name',currentUser.name],['Role',currentRole],['Email',data.email||'N/A'],['Phone',data.phone||'N/A'],['Address',data.address||'N/A'],isStudent?['GPA',data.gpa]:['ID',data.id]].map(([k,v])=>`
            <div style="display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border)">
              <span style="font-size:13px;color:var(--text2)">${k}</span>
              <span style="font-size:13px;font-weight:600">${v}</span>
            </div>
          `).join('')}
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">üîê Security</div></div>
        <div class="card-body">
          <div class="form-group"><label>Current Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="form-group"><label>New Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <div class="form-group"><label>Confirm Password</label><input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
          <button class="btn btn-blue" onclick="showToast('üîê','Password changed successfully!')">üîí Change Password</button>
        </div>
      </div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSettings(content) {
  content.innerHTML=`
    <div class="profile-grid">
      <div class="card">
        <div class="card-header"><div class="card-title">üè´ School Settings</div></div>
        <div class="card-body">
          <div class="form-group"><label>School Name</label><input value="VannEdu International School"></div>
          <div class="form-group"><label>Academic Year</label><input value="2025-2026"></div>
          <div class="form-group"><label>Monthly Fee ($)</label><input type="number" value="45"></div>
          <div class="form-group"><label>Working Days</label><select><option>Monday‚ÄìFriday</option><option>Monday‚ÄìSaturday</option></select></div>
          <button class="btn btn-blue" onclick="showToast('‚úÖ','Settings saved!')">üíæ Save Settings</button>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">üìß Notification Settings</div></div>
        <div class="card-body">
          ${[['Email notifications','Send grade updates via email',true],['SMS alerts','Send attendance SMS to parents',true],['Payment reminders','Auto-send fee reminders',false],['Absence alerts','Alert when student absent 3+ days',true]].map(([t,d,v])=>`
            <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--border)">
              <div><div style="font-size:13px;font-weight:600">${t}</div><div style="font-size:12px;color:var(--text3);margin-top:2px">${d}</div></div>
              <label style="position:relative;width:44px;height:24px;cursor:pointer">
                <input type="checkbox" ${v?'checked':''} style="opacity:0;position:absolute" onchange="showToast('‚öôÔ∏è','Setting updated!')">
                <span style="position:absolute;inset:0;border-radius:12px;background:${v?'var(--accent)':'var(--surface3)'};transition:background 0.2s"></span>
                <span style="position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:3px;left:${v?'23':'3'}px;transition:left 0.2s"></span>
              </label>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MODAL HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal() { document.getElementById('modalOverlay').classList.add('open'); }
function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let toastTimer;
function showToast(icon, msg) {
  const t=document.getElementById('toast');
  document.getElementById('toastIcon').textContent=icon;
  document.getElementById('toastMsg').textContent=msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),3000);
}
</script>
</body>
</html>
